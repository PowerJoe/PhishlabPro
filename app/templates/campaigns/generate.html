{% extends "base.html" %}

{% block title %}AI Email Generator | PhishLab Pro{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="glitch" data-text="AI EMAIL GENERATOR">AI EMAIL GENERATOR</h1>
        <p class="subtitle">Powered by Groq AI (Llama 3.3 70B)</p>
    </div>

    <div class="grid-2">
        <!-- Generation Form -->
        <div class="card">
            <h2>Generate Phishing Email</h2>
            
            <form id="emailGeneratorForm" method="POST" action="{{ url_for('campaigns.generate_email') }}">
                {{ form.hidden_tag() }}
                
                <!-- Scenario Selection -->
                <div class="form-group">
                    <label for="scenario">Scenario</label>
                    <select name="scenario" id="scenario" class="form-control" required>
                        <option value="password_reset">Password Reset</option>
                        <option value="security_alert">Security Alert</option>
                        <option value="invoice">Invoice/Payment</option>
                        <option value="package_delivery">Package Delivery</option>
                        <option value="account_verify">Account Verification</option>
                        <option value="it_support">IT Support Request</option>
                        <option value="hr_notification">HR Notification</option>
                        <option value="custom">Custom Scenario</option>
                    </select>
                </div>

                <!-- Company/Brand -->
                <div class="form-group">
                    <label for="company">Impersonate Company/Brand</label>
                    <input type="text" name="company" id="company" class="form-control" 
                           placeholder="e.g., Microsoft, Google, IT Department" value="Microsoft" required>
                </div>

                <!-- Urgency Level -->
                <div class="form-group">
                    <label for="urgency">Urgency Level</label>
                    <select name="urgency" id="urgency" class="form-control">
                        <option value="low">Low - Routine</option>
                        <option value="medium" selected>Medium - Important</option>
                        <option value="high">High - Urgent</option>
                    </select>
                </div>

                <!-- Tone -->
                <div class="form-group">
                    <label for="tone">Email Tone</label>
                    <select name="tone" id="tone" class="form-control">
                        <option value="professional" selected>Professional</option>
                        <option value="casual">Casual/Friendly</option>
                        <option value="urgent">Urgent/Alarming</option>
                        <option value="formal">Formal/Corporate</option>
                    </select>
                </div>

                <!-- Custom Instructions -->
                <div class="form-group">
                    <label for="custom_instructions">Custom Instructions (Optional)</label>
                    <textarea name="custom_instructions" id="custom_instructions" 
                              class="form-control" rows="3" 
                              placeholder="Additional context or specific details to include..."></textarea>
                </div>

                <!-- Generate Button -->
                <button type="submit" class="btn btn-primary btn-block" id="generateBtn">
                    <span class="btn-text">ü§ñ Generate Email</span>
                    <span class="btn-loading" style="display: none;">
                        <span class="spinner"></span> Generating...
                    </span>
                </button>
            </form>

            <!-- AI Info -->
            <div class="info-box" style="margin-top: 20px;">
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                    ‚ö° Using <strong>Llama 3.3 70B</strong> via Groq AI<br>
                    üîí For authorized security testing only
                </p>
            </div>
        </div>

        <!-- Email Preview -->
        <div class="card">
            <h2>Email Preview</h2>
            
            <div id="emailPreview" style="min-height: 400px;">
                {% if email %}
                    <!-- Subject Line -->
                    <div class="email-subject" style="padding: 15px; background: var(--card-bg-lighter); border-left: 3px solid var(--accent-red); margin-bottom: 20px;">
                        <strong>Subject:</strong> {{ email.subject }}
                    </div>

                    <!-- Email Body -->
                    <div class="email-body" style="padding: 20px; background: var(--bg-secondary); border-radius: 4px; font-family: Arial, sans-serif; line-height: 1.6;">
                        {{ email.body | safe | replace('\n', '<br>') }}
                    </div>

                    <!-- Actions -->
                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="copyEmail()">üìã Copy to Clipboard</button>
                        <button class="btn btn-secondary" onclick="saveTemplate()">üíæ Save as Template</button>
                        <button class="btn btn-secondary" onclick="editEmail()">‚úèÔ∏è Edit</button>
                    </div>

                    <!-- Metadata -->
                    <div class="info-box" style="margin-top: 20px;">
                        <small style="color: var(--text-secondary);">
                            Model: {{ email.model }} ({{ email.provider }})<br>
                            Generated: {{ email.timestamp }}
                        </small>
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <p style="font-size: 3rem; margin-bottom: 10px;">üìß</p>
                        <p>Configure settings and click "Generate Email"</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">
                            AI-generated phishing emails appear here
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 30px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-primary);
    font-weight: 500;
}

.form-control {
    width: 100%;
    padding: 12px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-primary);
    font-size: 0.95rem;
}

.form-control:focus {
    outline: none;
    border-color: var(--accent-red);
}

select.form-control {
    cursor: pointer;
}

textarea.form-control {
    resize: vertical;
    font-family: inherit;
}

.btn-block {
    width: 100%;
}

.spinner {
    display: inline-block;
    width: 14px;
    height: 14px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.info-box {
    padding: 15px;
    background: var(--bg-secondary);
    border-left: 3px solid var(--accent-blue);
    border-radius: 4px;
}

@media (max-width: 968px) {
    .grid-2 {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// Handle form submission
document.getElementById('emailGeneratorForm').addEventListener('submit', function(e) {
    const btn = document.getElementById('generateBtn');
    const btnText = btn.querySelector('.btn-text');
    const btnLoading = btn.querySelector('.btn-loading');
    
    btnText.style.display = 'none';
    btnLoading.style.display = 'inline-block';
    btn.disabled = true;
});

// Copy email to clipboard
function copyEmail() {
    const subject = document.querySelector('.email-subject').textContent;
    const body = document.querySelector('.email-body').innerText;
    const fullEmail = subject + '\n\n' + body;
    
    navigator.clipboard.writeText(fullEmail).then(() => {
        alert('‚úÖ Email copied to clipboard!');
    });
}

// Save as template (TODO: implement)
function saveTemplate() {
    alert('üíæ Save template feature coming soon!');
}

// Edit email (TODO: implement)
function editEmail() {
    alert('‚úèÔ∏è Edit feature coming soon!');
}
</script>
{% endblock %}
