{% extends "base.html" %}

{% block title %}Email Generator | PhishLab Pro{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <div style="margin-bottom: 2rem;">
        <h1 class="glitch" data-text="EMAIL GENERATOR" style="font-size: 2.5rem;">EMAIL GENERATOR</h1>
        <p style="color: var(--text-secondary);">Create phishing emails with AI or manually</p>
    </div>
    
    <!-- Mode Selection -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
        <div class="card {% if has_api_key %}card-success{% endif %}" style="text-align: center; padding: 2rem;">
            <h3 style="color: var(--accent-green); margin-bottom: 1rem;">ü§ñ AI Generator</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                {% if has_api_key %}
                Claude AI will generate realistic emails
                {% else %}
                Requires Groq API key
                {% endif %}
            </p>
            {% if has_api_key %}
            <span class="badge badge-success">Available</span>
            {% else %}
            <span class="badge badge-danger">API Key Required</span>
            {% endif %}
        </div>
        
        <a href="{{ url_for('email_gen.manual') }}" class="card" style="text-align: center; padding: 2rem; text-decoration: none; cursor: pointer;">
            <h3 style="color: var(--accent-blue); margin-bottom: 1rem;">‚úçÔ∏è Manual Creator</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                Write your own custom emails
            </p>
            <span class="badge badge-success">Always Available</span>
        </a>
    </div>
    
    {% if has_api_key %}
    <!-- AI Generation Form -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        <div class="card">
            <h2 style="margin-bottom: 1.5rem; color: var(--accent-green);">ü§ñ AI Generation</h2>
            
            <form method="POST" id="generateForm">
                {{ form.hidden_tag() }}
                
                <div class="form-group">
                    {{ form.target_name.label }}
                    {{ form.target_name(class="form-control", placeholder="e.g., John Smith") }}
                </div>
                
                <div class="form-group">
                    {{ form.company.label }}
                    {{ form.company(class="form-control", placeholder="e.g., TechCorp Inc") }}
                </div>
                
                <div class="form-group">
                    {{ form.job_title.label }}
                    {{ form.job_title(class="form-control", placeholder="e.g., Senior Developer") }}
                </div>
                
                <div class="form-group">
                    {{ form.scenario.label }}
                    {{ form.scenario(class="form-control") }}
                </div>
                
                <div class="form-group">
                    {{ form.custom_details.label }}
                    {{ form.custom_details(class="form-control", rows="3", placeholder="Add specific details...") }}
                </div>
                
                <button type="submit" class="btn btn-primary" id="generateBtn" style="width: 100%; padding: 1rem;">
                    <span id="btnText">‚ö° Generate Email</span>
                    <span id="btnLoading" style="display: none;">
                        <span class="loading"></span> Generating...
                    </span>
                </button>
            </form>
        </div>
        
        <div>
            <div class="card card-success" style="margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-green); margin-bottom: 1rem;">‚ú® How It Works</h3>
                <ol style="color: var(--text-secondary); line-height: 1.8;">
                    <li>Enter target information</li>
                    <li>Select phishing scenario</li>
                    <li>AI generates personalized email</li>
                    <li>Preview and edit if needed</li>
                    <li>Save as template</li>
                </ol>
            </div>
            
            <div class="card">
                <h3 style="color: var(--accent-red); margin-bottom: 1rem;">‚ö†Ô∏è Scenarios</h3>
                <div style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.8;">
                    <p><strong style="color: var(--accent-green);">üîí IT Security:</strong> Security updates, MFA</p>
                    <p><strong style="color: var(--accent-green);">üëî CEO Request:</strong> Urgent approvals</p>
                    <p><strong style="color: var(--accent-green);">üìã HR Update:</strong> Policy changes</p>
                    <p><strong style="color: var(--accent-green);">üí∞ Invoice:</strong> Payment requests</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    document.getElementById('generateForm').addEventListener('submit', function() {
        const btnText = document.getElementById('btnText');
        const btnLoading = document.getElementById('btnLoading');
        btnText.style.display = 'none';
        btnLoading.style.display = 'inline';
    });
    </script>
    
    {% else %}
    <!-- No API Key Message -->
    <div class="card" style="text-align: center; padding: 4rem 2rem;">
        <h2 style="color: var(--accent-red); margin-bottom: 1rem;">‚ö†Ô∏è AI Generator Ready</h2>
        <p style="color: var(--text-secondary); margin-bottom: 2rem;">
            Groq API key not configured. Use the Manual Creator instead.
        </p>
        <a href="{{ url_for('email_gen.manual') }}" class="btn btn-primary">
            ‚úçÔ∏è Go to Manual Creator
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
